{layout name="layout" /}

<!-- Imported scripts on this page -->
<script src="__STATIC__/js/rwd-table/js/rwd-table.min.js"></script>
<script src="__STATIC__/js/datatables/js/jquery.dataTables.min.js"></script>

<!-- <link rel="stylesheet" href="__STATIC__/css/xenon-forms.css"> -->

<!-- Imported scripts on this page -->
<script src="__STATIC__/js/datatables/dataTables.bootstrap.js"></script>
<script src="__STATIC__/js/datatables/yadcf/jquery.dataTables.yadcf.js"></script>
<script src="__STATIC__/js/datatables/tabletools/dataTables.tableTools.min.js"></script>

<script src="__STATIC__/js/table-export/xlsx.core.min.js"></script>
<script src="__STATIC__/js/table-export/blob.js"></script>
<script src="__STATIC__/js/table-export/FileSaver.min.js"></script>
<script src="__STATIC__/js/table-export/tableexport.js"></script>

<div class="page-title">

    <div class="breadcrumb-env pull-left">

        <ol class="breadcrumb bc-1">
            <li>
                <a href="{:url('User/index')}"><i class="fa-home"></i>首页</a>
            </li>
            <li>
                <a href="">系统设置</a>
            </li>
            <li class="active">
                <strong>角色管理</strong>
            </li>
        </ol>

    </div>
</div>


<div class="row">
    <div class="col-md-12">
        <!-- Removing search and results count filter -->
        <div class="panel panel-default">
            <div class="panel-heading btn-toolbar">
                <div class="btn-group focus-btn-group">
                    <button class="btn btn-default btn-primary" onclick="showAjaxModal();">
                        <span class="fa-plus"></span> 添 加
                    </button>
                </div>

            </div>
            <div class="panel-body">
                <table class="table table-bordered table-striped" id="example-2">
                    <thead>
                    <tr>
                        <th>角色ID</th>
                        <th>角色名称</th>
                        <th>角色节点</th>
                        <th>状态</th>
                        <th>备注</th>
                        <th>创建时间</th>
                        <th>操作</th>
                    </tr>
                    </thead>

                    <tbody class="middle-align">

                    {volist name='role' id='role'}
                    <tr>
                        <td> {$role.id} </td>
                        <td> {$role.name} </td>
                        <td> {$role.ids} </td>
                        <td> {if $role.status==0}
                            <div class="label label-danger">禁用</div>
                            {else /}
                            <div class="label label-success">启用</div>
                            {/if}
                        </td>
                        <td> {$role.desc} </td>
                        <td> {$role.create_time} </td>
                        <td>
                            <a href="javascript:;"
                               class="btn btn-secondary btn-sm btn-icon icon-left"
                               onclick="editAjaxModal('{:url('/User/role_edit/id/'.$role->id)}')" >
                                编辑
                            </a>

                            <a href="javascript:;" class="btn btn-danger btn-sm btn-icon icon-left" onclick="del('{$role.id}')">
                                删除
                            </a>

                        </td>
                    </tr>
                    {/volist}

                    </tbody>
                </table>

                <div class="row">
                    <div class="col-xs-6">
                        <div class="dataTables_info" id="example-3_info" role="status" aria-live="polite"> 共{:count( $role ) } 行数据</div></div>
                    <div class="col-xs-6">
                        <div class="dataTables_paginate paging_simple_numbers" id="example-3_paginate">

                        </div>
                    </div>
                </div>

            </div>
        </div>



        <!-- *********************************************************************************************************************** -->


        <!-- Modal add (Ajax Modal)-->
        <div class="modal fade " id="modal-add">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">添加管理</h4>
                    </div>

                    <div class="modal-body">
                        Content is loading...
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-info" onclick="add_from()">确定</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal edit (Ajax Modal)-->
        <div class="modal fade " id="modal-edit">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">编辑管理</h4>
                    </div>

                    <div class="modal-body">
                        Content is loading...
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-info" onclick="edit_from()">确定</button>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            //add
            function showAjaxModal(){
                jQuery('#modal-add').modal('show', {backdrop: 'static'});

                jQuery.ajax({
                    url: "{:url('User/role_add')}",
                    success: function(response)
                    {
                        jQuery('#modal-add .modal-body').html(response);
                    }
                });
            }

            function add_from(){
                var res = $(".add-form").serializeArray();

                $.post("{:url('User/role_save')}", res,function(data){
                    if( data.error>0 ){
                        toastr.error( data.msg );
                    }else{
                        toastr.success( data.msg );
                        jQuery('#modal-add').modal('hide');
                        location.reload();
                    }
                }, "json");

            }

            //edit
            function editAjaxModal(url){
                jQuery('#modal-edit').modal('show', {backdrop: 'static'});

                jQuery.ajax({
                    url: url,
                    success: function(response)
                    {
                        jQuery('#modal-edit .modal-body').html(response);
                    }
                });
            }
            function edit_from(){
                var res = $(".edit_from").serializeArray();

                $.post("{:url('User/role_update')}", res,function(data){
                    if( data.error>0 ){
                        toastr.error( data.msg );
                    }else{
                        toastr.success( data.msg );
                        jQuery('#modal-edit').modal('hide');
                        location.reload();
                    }
                }, "json");

            }

            //del
            function del(id){
                if( confirm("确定要删除吗？") ){
                    $.post("{:url('User/role_delete')}", {id:id},function(data){
                        if( data.error>0 ){
                            toastr.error( data.msg );
                        }else{
                            toastr.success( data.msg );
                            location.reload();
                        }
                    }, "json");
                }

            }
        </script>