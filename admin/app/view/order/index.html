{layout name="layout" /}

    <!-- Imported scripts on this page -->
    <script src="__STATIC__/js/rwd-table/js/rwd-table.min.js"></script>
    <script src="__STATIC__/js/datatables/js/jquery.dataTables.min.js"></script>

    <!-- <link rel="stylesheet" href="__STATIC__/css/xenon-forms.css"> -->

    <!-- Imported scripts on this page -->
    <script src="__STATIC__/js/datatables/dataTables.bootstrap.js"></script>
    <script src="__STATIC__/js/datatables/yadcf/jquery.dataTables.yadcf.js"></script>
    <script src="__STATIC__/js/datatables/tabletools/dataTables.tableTools.min.js"></script>

    <script src="__STATIC__/js/table-export/xlsx.core.min.js"></script>
    <script src="__STATIC__/js/table-export/blob.js"></script>
    <script src="__STATIC__/js/table-export/FileSaver.min.js"></script>
    <script src="__STATIC__/js/table-export/tableexport.js"></script>

<div class="page-title">  
    
    <div class="breadcrumb-env pull-left">
        
        <ol class="breadcrumb bc-1">
            <li>
                <a href="{:url('Order/index')}"><i class="fa-home"></i>首页</a>
            </li>
            <li>
                <a href="">订单管理</a>
             </li>
            <li class="active">
                <strong>订单查询</strong>
            </li>
        </ol>
                    
    </div>       
</div>



<div class="row">
                <div class="col-md-12">


<!-- ******************************************************************************************************** -->



            <!-- Removing search and results count filter -->
            <div class="panel panel-default">
                <div class="panel-heading btn-toolbar">
                     <h3 class="panel-title">交易列表</h3>
                    <div class="btn-group dropdown-btn-group pull-right">
                        <button class="btn btn-default" >导出</button>
                    </div>
                </div>
                <div class="panel-body">
                    <!-- searach -->
                    <div class="btn-toolbar">

                        <form class="form-inline" style="margin-bottom:15px;" class="search-tool">
                            <span>
                                <label class="control-label">平台订单号</label>
                                <input type="text" class="form-control" placeholder="平台订单号" name="trade_no" value="{$Request.get.trade_no}">
                            </span>

                            <span style="margin-left: 15px;">
                                <label class="control-label">商户订单号</label>
                                <input type="text" class="form-control" placeholder="商户订单号" name="out_trade_no" value="{$Request.get.out_trade_no}">
                            </span>
                            <span style="margin-left: 15px;">
                                <label class="control-label">商户号</label>
                                <input type="text" class="form-control" placeholder="商户号" name="uid" value="{$Request.get.uid}">
                            </span>

                            <span style="margin-left: 15px;">
                                <label class="control-label">订单状态</label>
                                <select class="form-control" name="status">
                                    <option value="" 
                                        {eq name="Request.get.status" value=" "} selected="selected" {/eq}>全部</option>
                                    <option value="0" 
                                        {eq name="Request.get.status" value="0"} selected="selected" {/eq}>已关闭</option>
                                    <option value="1"
                                        {eq name="Request.get.status" value="1"} selected="selected" {/eq}>待支付</option>
                                    <option value="2"
                                        {eq name="Request.get.status" value="2"} selected="selected" {/eq}>已支付</option>
                                </select>   
                            </span>

                            <span style="margin-left: 15px;">
                                <button class="btn btn-default btn-primary" type="submit" style="margin-top:10px;">
                                    <span class="fa-search"></span> 搜 索
                                </button> 
                            </span>
                        
                        </form>
                        
                    </div>
                    <!-- searach -->

                    <table class="table table-bordered table-striped" id="example-2">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>所属商户</th>
                                <th>平台订单号</th>
                                <th>商户订单号</th>
                                <th>支付项目</th>
                                <th>支付内容</th>
                                <th>支付渠道</th>
                                <th>状态</th>
                                <th>创建时间</th>
                                <th>更新时间</th>
                            </tr>
                        </thead>
                        
                        <tbody class="middle-align">
                        
                        {volist name='list' id='vo'}
                            <tr>
                                <td> {$vo.id} </td>
                                <td> {$vo.uid} </td>
                                <td> {$vo.trade_no} </td>
                                <td> {$vo.out_trade_no} </td>
                                <td> {$vo.subject} </td>
                                <td> {$vo.body} </td>
                                <td> {$vo.channel} </td>
                                <td>
                                    {if $vo.status==0}
                                    <div class="label label-primary">已关闭</div>
                                    {elseif $vo.status==1}
                                    <div class="label label-warning">待支付</div>
                                    {elseif $vo.status==2}
                                    <div class="label label-success">已支付</div>
                                    {else /}
                                    <div class="label label-danger">订单异常</div>
                                    {/if}
                                </td>
                                <td> {$vo.create_time} </td>
                                <td> {$vo.update_time} </td>
                            </tr>
                        {/volist}

                        </tbody>
                    </table>

                    <div class="row">
                        <div class="col-xs-6">
                            <div class="dataTables_info" id="example-3_info" role="status" aria-live="polite"> 共{:count( $list ) } 行数据</div></div>
                        <div class="col-xs-6">
                            <div class="dataTables_paginate paging_simple_numbers" id="example-3_paginate">
                                {$list->render()}
                            </div>
                        </div>
                    </div>                  

                </div>
            </div>



<!-- *********************************************************************************************************************** -->


    <!-- Modal add (Ajax Modal)-->
    <div class="modal fade " id="modal-add">
        <div class="modal-dialog">
            <div class="modal-content">
                
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">添加订单</h4>
                </div>
                
                <div class="modal-body">
                    Content is loading...
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-info" onclick="add_from()">确定</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal edit (Ajax Modal)-->
    <div class="modal fade " id="modal-edit">
        <div class="modal-dialog">
            <div class="modal-content">
                
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">编辑订单</h4>
                </div>
                
                <div class="modal-body">
                    Content is loading...
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-info" onclick="edit_from()">确定</button>
                </div>
            </div>
        </div>
    </div>    

<script type="text/javascript">
    //add
    function showAjaxModal(){
        jQuery('#modal-add').modal('show', {backdrop: 'static'});
        
        jQuery.ajax({
            url: "{:url('Order/create')}",
            success: function(response)
            {
                jQuery('#modal-add .modal-body').html(response);
            }
        });
    }

    function add_from(){
        var res = $(".add-form").serializeArray();

        $.post("{:url('Order/save')}", res,function(data){
            if( data.error>0 ){
                toastr.error( data.msg );  
            }else{
                toastr.success( data.msg );  
                jQuery('#modal-add').modal('hide');
                location.reload();
            }
        }, "json");

    }

    //edit
    function editAjaxModal(url){
        jQuery('#modal-edit').modal('show', {backdrop: 'static'});
        
        jQuery.ajax({
            url: url,
            success: function(response)
            {
                jQuery('#modal-edit .modal-body').html(response);
            }
        });
    }
    function edit_from(){
        var res = $(".edit_from").serializeArray();

        $.post("{:url('Order/update')}", res,function(data){
            if( data.error>0 ){
                toastr.error( data.msg );  
            }else{
                toastr.success( data.msg );  
                jQuery('#modal-edit').modal('hide');
                location.reload();
            }
        }, "json");

    }

    //del
    function del(id){
        if( confirm("确定要删除吗？") ){
            $.post("{:url('Order/delete')}", {id:id},function(data){
                if( data.error>0 ){
                    toastr.error( data.msg );  
                }else{
                    toastr.success( data.msg );  
                    location.reload();
                }
            }, "json");
        } 

    }
</script>